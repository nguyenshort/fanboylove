"use strict";(self.webpackChunkserver=self.webpackChunkserver||[]).push([[770],{9770:(a,t,s)=>{s.r(t),s.d(t,{default:()=>r});var o=s(630);const e={name:"AccountSetting",props:["user"],data(){return{userData:JSON.parse(this.user),form:{name:"",email:"",avatar:"",password:"",currentPass:"",rePass:""},upload:{avatar:""},isLoading:!1,isLoadingImage:!1,showCrop:!1}},methods:{async updateInfo(a,t){this.isLoading=!0;try{const{data:{userSettings:s}}=await this.$apollo.mutate({mutation:o.t0,variables:{key:a,value:t}});this.userData=Object.assign({},this.userData,s)}catch(a){}this.isLoading=!1},async updatePassword(){this.isLoading=!0;try{await this.$apollo.mutate({mutation:o.o4,variables:{oldPass:this.form.currentPass,newPass:this.form.password}})}catch(a){}this.isLoading=!1},openCropImage(a){this.showCrop=!1,this.upload.avatar=URL.createObjectURL(a.target.files[0]),window.$("#crop-avatar-modal").modal("show"),setTimeout((()=>{this.showCrop=!0}),400)},cropAvatar(){this.$refs.cropper.getCroppedCanvas().toBlob((a=>{if(!a)return!1;{this.isLoadingImage=!0;const t=new FormData;t.append("image",a),t.append("pathName",`users/${this.userData._id}/avatar`),t.append("type","user-avatar"),this.$http.post("/upload/single",t).then((({data:a})=>{this.form.avatar=a.data,window.$("#crop-avatar-modal").modal("hide")})).catch().finally((()=>{this.isLoadingImage=!1}))}}))}}},r=(0,s(1900).Z)(e,(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("div",{attrs:{id:"form-account-settings"}},[s("div",{staticClass:"tab-group-item"},[s("div",{staticClass:"tab-item"},[s("div",{staticClass:"choose-avatar"},[s("div",{staticClass:"c-user-avatar"},[s("img",{staticClass:"avatar avatar-195 photo",attrs:{alt:"",src:a.form.avatar||a.userData.avatar,height:"195",width:"195"}})])]),a._v(" "),s("div",{staticClass:"form form-choose-avatar"},[s("div",{staticClass:"select-flie"},[a._v("\n          Nhấp để tải lên\n          "),s("label",{staticClass:"select-avata"},[s("input",{attrs:{type:"file",name:"wp-manga-user-avatar"},on:{change:function(t){return a.openCropImage(t)}}}),a._v(" "),s("span",{staticClass:"file-name"})]),a._v(" "),s("input",{attrs:{id:"wp-manga-upload-avatar",type:"submit",value:"Cập Nhật",name:"wp-manga-upload-avatar",disabled:!a.form.avatar||a.isLoading},on:{click:function(t){return t.preventDefault(),a.updateInfo("avatar",a.form.avatar)}}})])])]),a._v(" "),s("div",{staticClass:"tab-item"},[a._m(0),a._v(" "),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-md-3"},[a._v("Tên Hiện Tại")]),a._v(" "),s("div",{staticClass:"col-md-9"},[s("span",{staticClass:"show"},[a._v(a._s(a.userData.name))])])]),a._v(" "),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-md-3"},[a._v("Tên Mới")]),a._v(" "),s("div",{staticClass:"col-md-9"},[s("input",{directives:[{name:"model",rawName:"v-model",value:a.form.name,expression:"form.name"}],staticClass:"form-control",attrs:{autocomplete:"off",type:"text",name:"user-new-name"},domProps:{value:a.form.name},on:{input:function(t){t.target.composing||a.$set(a.form,"name",t.target.value)}}})])]),a._v(" "),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-md-3",attrs:{for:"name-input-submit"}}),a._v(" "),s("div",{staticClass:"col-md-9"},[s("input",{staticClass:"form-control",attrs:{id:"name-input-submit",disabled:!a.form.name||a.isLoading,type:"submit",value:"Xác Nhận",name:"account-form-submit"},on:{click:function(t){return t.preventDefault(),a.updateInfo("name",a.form.name)}}})])])]),a._v(" "),s("div",{staticClass:"tab-item"},[a._m(1),a._v(" "),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-md-3"},[a._v("Email Hiện Tại")]),a._v(" "),s("div",{staticClass:"col-md-9"},[s("span",{staticClass:"show"},[a._v(a._s(a.userData.email))])])]),a._v(" "),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-md-3"},[a._v("Email Mới")]),a._v(" "),s("div",{staticClass:"col-md-9"},[s("input",{directives:[{name:"model",rawName:"v-model",value:a.form.email||a.isLoading,expression:"form.email || isLoading"}],staticClass:"form-control",attrs:{autocomplete:"off",type:"text",name:"user-new-name"},domProps:{value:a.form.email||a.isLoading},on:{input:function(t){t.target.composing||a.$set(a.form,"email || isLoading",t.target.value)}}})])]),a._v(" "),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-md-3",attrs:{for:"name-input-submit"}}),a._v(" "),s("div",{staticClass:"col-md-9"},[s("input",{staticClass:"form-control",attrs:{disabled:!a.form.email||a.isLoading,autocomplete:"off",type:"submit",value:"Xác Nhận",name:"account-form-submit"},on:{click:function(t){return t.preventDefault(),a.updateInfo("email",a.form.email)}}})])])]),a._v(" "),s("div",{staticClass:"tab-item"},[a._m(2),a._v(" "),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-md-3",attrs:{for:"currrent-password-input"}},[a._v("Mật khẩu hiện tại")]),a._v(" "),s("div",{staticClass:"col-md-9"},[s("input",{directives:[{name:"model",rawName:"v-model",value:a.form.currentPass,expression:"form.currentPass"}],staticClass:"form-control",attrs:{id:"currrent-password-input",type:"password",value:"",name:"user-current-password"},domProps:{value:a.form.currentPass},on:{input:function(t){t.target.composing||a.$set(a.form,"currentPass",t.target.value)}}})])]),a._v(" "),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-md-3",attrs:{for:"new-password-input"}},[a._v(" Mật Khẩu Mới ")]),a._v(" "),s("div",{staticClass:"col-md-9"},[s("input",{directives:[{name:"model",rawName:"v-model",value:a.form.password,expression:"form.password"}],staticClass:"form-control",attrs:{id:"new-password-input",type:"password",value:"",name:"user-new-password"},domProps:{value:a.form.password},on:{input:function(t){t.target.composing||a.$set(a.form,"password",t.target.value)}}})])]),a._v(" "),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-md-3",attrs:{for:"comfirm-password-input"}},[a._v(" Xác Nhận Mật Khẩu ")]),a._v(" "),s("div",{staticClass:"col-md-9"},[s("input",{directives:[{name:"model",rawName:"v-model",value:a.form.rePass,expression:"form.rePass"}],staticClass:"form-control",attrs:{id:"comfirm-password-input",type:"password",value:"",name:"user-new-password-confirm"},domProps:{value:a.form.rePass},on:{input:function(t){t.target.composing||a.$set(a.form,"rePass",t.target.value)}}}),a._v(" "),s("span",{attrs:{id:"password-strength"}})])]),a._v(" "),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-md-3",attrs:{for:"password-input-submit"}}),a._v(" "),s("div",{staticClass:"col-md-9"},[s("input",{staticClass:"form-control",attrs:{id:"password-input-submit",type:"submit",value:"Thay Đổi",name:"account-form-submit",disabled:a.form.currentPass.length<6||a.form.password<6||a.form.password!==a.form.rePass||a.isLoading},on:{click:function(t){return t.preventDefault(),a.updatePassword()}}})])])])]),a._v(" "),s("div",{staticClass:"modal fade",attrs:{id:"crop-avatar-modal",tabindex:"-1",role:"dialog"}},[s("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[s("div",{staticClass:"modal-content"},[a._m(3),a._v(" "),s("div",{staticClass:"modal-body"},[s("h3",[a._v("Cắt Ảnh Của Bạn")]),a._v(" "),s("div",{attrs:{id:"crop-avatar"}},[a.showCrop?s("vue-cropper",{ref:"cropper",attrs:{id:"cropImage",src:a.upload.avatar,"output-type":"jpg","crop-box-resizable":!1,"toggle-drag-mode-on-dblclick":!1,"drag-mode":"move","aspect-ratio":1,"view-mode":1,"crop-box-movable":!1}}):a._e()],1),a._v(" "),s("div",{staticClass:"list-button d-flex justify-content-center mt-3"},[s("div",{staticClass:"crop-butotn-action",on:{click:function(t){return a.$refs.cropper.rotate(-90)}}},[s("i",{staticClass:"fas fa-undo"})]),a._v(" "),s("div",{staticClass:"crop-butotn-action",on:{click:function(t){return a.$refs.cropper.relativeZoom(-.2)}}},[s("i",{staticClass:"fas fa-search-minus"})]),a._v(" "),s("div",{staticClass:"crop-butotn-action",on:{click:function(t){return a.$refs.cropper.relativeZoom(.2)}}},[s("i",{staticClass:"fas fa-search-plus"})]),a._v(" "),s("div",{staticClass:"crop-butotn-action",on:{click:function(t){return a.$refs.cropper.rotate(90)}}},[s("i",{staticClass:"fas fa-undo"})])])]),a._v(" "),s("div",{staticClass:"modal-footer pb-2"},[s("input",{staticClass:"crop-button",attrs:{type:"submit",value:"Cắt Ảnh",name:"wp-manga-upload-avatar",disabled:a.isLoadingImage},on:{click:function(t){return a.cropAvatar()}}})])])])])])}),[function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("div",{staticClass:"settings-title"},[s("h3",[a._v("Tên Hiển Thị")])])},function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("div",{staticClass:"settings-title"},[s("h3",[a._v("Email Đăng Ký")])])},function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("div",{staticClass:"settings-title"},[s("h3",[a._v("Đổi Mật Khẩu")])])},function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("div",{staticClass:"modal-header"},[s("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[s("span",{attrs:{"aria-hidden":"true"}},[a._v("×")])])])}],!1,null,null,null).exports}}]);